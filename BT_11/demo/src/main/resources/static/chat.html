<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Customer Support Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px }
    #chat { border: 1px solid #ccc; height: 300px; overflow:auto; padding:8px }
    #message { width: 70% }
    #username { width: 200px }
    .meta { color: #888; font-size: 0.9em }
  </style>
</head>
<body>
  <h3>Customer Support Chat (Demo)</h3>

  <div>
    <input id="username" placeholder="Your name" />
    <button id="connect">Connect</button>
    <button id="disconnect" disabled>Disconnect</button>
  </div>

  <div id="chat"></div>

  <div style="margin-top:8px">
    <input id="message" placeholder="Type message..." />
    <button id="send">Send</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script>
    let stompClient = null;

    function setConnected(connected) {
      document.getElementById('connect').disabled = connected;
      document.getElementById('disconnect').disabled = !connected;
      document.getElementById('send').disabled = !connected;
    }

    function connect() {
      const socket = new SockJS('/ws');
      stompClient = Stomp.over(socket);
      stompClient.connect({}, function(frame) {
        setConnected(true);
        stompClient.subscribe('/topic/public', function(msg){
          showMessage(JSON.parse(msg.body));
        });

        const name = document.getElementById('username').value || 'Anonymous';
        stompClient.send('/app/chat.addUser', {}, JSON.stringify({sender: name, content:'joined'}));
      });
    }

    function disconnect() {
      if (stompClient) stompClient.disconnect();
      setConnected(false);
    }

    function sendMessage() {
      const content = document.getElementById('message').value;
      const sender = document.getElementById('username').value || 'Anonymous';
      if (!content) return;
      const payload = {type: 'CHAT', sender: sender, content: content};
      stompClient.send('/app/chat.sendMessage', {}, JSON.stringify(payload));
      document.getElementById('message').value = '';
    }

    function showMessage(message) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      if (message.type === 'JOIN') {
        div.innerHTML = `<span class="meta">${message.sender} has joined</span>`;
      } else if (message.type === 'LEAVE') {
        div.innerHTML = `<span class="meta">${message.sender} left</span>`;
      } else {
        div.innerHTML = `<strong>${message.sender}:</strong> ${message.content}`;
      }
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    document.getElementById('connect').addEventListener('click', connect);
    document.getElementById('disconnect').addEventListener('click', disconnect);
    document.getElementById('send').addEventListener('click', sendMessage);
    document.getElementById('message').addEventListener('keyup', function(e){ if (e.key === 'Enter') sendMessage(); });
  </script>
</body>
</html>
